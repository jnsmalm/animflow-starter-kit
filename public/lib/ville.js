!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("VILLE",[],t):"object"==typeof exports?exports.VILLE=t():e.VILLE=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let o=[];function i(e){return o[o.length-1].add(e)}t.task=i,i.get_tasks=(e=>{let t=[];return o.push({add:e=>(t.push(e),e)}),e(),o.pop(),t}),i.have_task_manager=(()=>o.length>0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),i=n(0);t.sequence=function(e){let t=!1,n=!1,r=function*(){let o=i.task.get_tasks(e);for(let e of o){if(n)return void(t=!0);for(let o of e()){if(n)return void(t=!0);yield}}t=!0};return i.task.have_task_manager()?i.task(function*(){yield*r()}):o.thread(function*(){yield*r()}),{cancel:function(){i.task(function*(){n=!0})},completed:function(){return t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),i=n(0),r=n(4);function u(e,t,n,o){return e+(t-e)*o(n)}t.tween=function(e){let t=r.ease.linear,n={},c=0;return i.task(function*(){let i={};for(let t in n)i[t]=e[t];let r=0;for(;r<c&&c>0;){r+=o.time.elapsed();let s=Math.min(1,r/c);for(let o in i)e[o]=u(i[o],n[o],s,t);yield}for(let t in i)e[t]=n[t]}),{to:function(e){return n=e,this},ease:function(e=r.ease.sine_inout){return t=e,this},time:function(e){return c=e,this}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let o=[],i=[],r=0;function u(e){if("function"!=typeof e)throw new TypeError("A thread only acceps a 'generator function' as an argument");let t=e();if(!t||!t.next)throw new TypeError("A thread only acceps a 'generator function' as an argument");let n={job:t,priority:0,id:r++,cancel:!1};return i.push(n),{cancel:function(){n.cancel=!0},priority:function(e){return n.priority=e,this}}}function c(e){e.sort((e,t)=>e.priority===t.priority?t.id-e.id:t.priority-e.priority);for(let t=e.length-1;t>=0;t--)(e[t].cancel||e[t].job.next().done)&&e.splice(t,1)}t.thread=u,u.run_all=function(){if(i.length>0){for(let e=0;e<i.length;e++)o.push(i[e]);i=[]}c(o),c(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.linear=function(e){return e},e.sine_in=function(e){return-1*Math.cos(e*(Math.PI/2))+1},e.sine_inout=function(e){return-.5*(Math.cos(Math.PI*e)-1)},e.sine_out=function(e){return Math.sin(e*(Math.PI/2))}}(t.ease||(t.ease={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t=0;e.elapsed=function(e){return void 0!==e&&(t=e),t}}(t.time||(t.time={}))},function(e,t,n){"use strict";function o(e=0,t=0){return{x:e,y:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.vector=o,o.add=((e,t)=>o(e.x+t.x,e.y+t.y)),o.sub=((e,t)=>o(e.x-t.x,e.y-t.y)),o.dot=((e,t)=>e.x*t.x+e.y*t.y),o.mul=((e,t)=>o(e.x*t,e.y*t)),o.neg=(e=>o(-1*e.x,-1*e.y)),o.normalize=(e=>{let t=o.len(e);return o(e.x/t,e.y/t)}),o.len=(e=>Math.sqrt(e.x*e.x+e.y*e.y))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),i=n(1),r=n(3);let u;t.game={load:e=>{fetch("assets.json").then(e=>{if(e.ok)return e.json()}).then(n=>{Object.assign(t.game,n);for(let e in n)PIXI.loader.add(e,n[e]);PIXI.loader.load(()=>{e&&i.sequence(e)})})},application:()=>u,stage:()=>u.stage,init:(e=800,t=600,n=!0)=>{if((u=new PIXI.Application({width:e,height:t})).ticker.add(()=>{o.time.elapsed(u.ticker.elapsedMS/1e3),r.thread.run_all()}),document.body.appendChild(u.view),n){let n=()=>{u.renderer.resize(window.innerWidth,window.innerHeight),u.stage.position.set(window.innerWidth/2,window.innerHeight/2),u.stage.scale.set(Math.min(window.innerWidth/e,window.innerHeight/t))};window.onresize=n,n()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.repeat=function(e){let t=!1,n=Number.MAX_VALUE,i=!1;return o.task(function*(){for(let r=0;r<n;r++){if(i)return void(t=!0);let n=o.task.get_tasks(e);for(let e of n)yield*e();yield}t=!0}),{cancel:function(){o.task(function*(){i=!0})},completed:function(){return t},times:function(e){n=e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(5);t.time=o.time;var i=n(3);t.thread=i.thread;var r=n(7);t.game=r.game;var u=n(10);t.sprite=u.sprite;var c=n(11);t.text=c.text;var s=n(12);t.remove=s.remove;var a=n(13);t.key=a.key;var l=n(14);t.collision=l.collision;var f=n(18);t.wait=f.wait;var d=n(0);t.task=d.task;var p=n(1);t.sequence=p.sequence;var h=n(19);t.parallel=h.parallel;var y=n(2);t.tween=y.tween;var v=n(4);t.ease=v.ease;var b=n(20);t.move=b.move;var m=n(21);t.rotate=m.rotate;var _=n(22);t.scale=_.scale;var w=n(23);t.show=w.show;var g=n(24);t.hide=g.hide;var x=n(25);t.sound=x.sound;var k=n(26);t.proceed=k.proceed;var M=n(8);t.repeat=M.repeat},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7),i=n(0);t.sprite=function(e,t){let n;return(n=e?PIXI.Sprite.from(e):new PIXI.Sprite).anchor.set(.5),i.task(function*(){t||(t=o.game.stage()),t.addChild(n)}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(7),i=n(0);t.text=function(e,t){let n=new PIXI.Text(e,{fontFamily:"Helvetica",fontSize:36,fill:16777215,align:"center"});return n.anchor.set(.5),i.task(function*(){t||(t=o.game.stage()),t.addChild(n)}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.remove=function(e){o.task(function*(){e.parent&&e.parent.removeChild(e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(1),r=n(8);t.key=function(e){return{down:t=>{let n;return o.task(function*(){n=c(e,"down",t)}),{cancel:()=>{o.task(function*(){s(e,"down",n)})}}},up:t=>{let n;return o.task(function*(){n=c(e,"up",t)}),{cancel:()=>{o.task(function*(){s(e,"up",n)})}}},repeat:t=>{let n,i,u;return o.task(function*(){n=c(e,"down",()=>{u=r.repeat(t)}),i=c(e,"up",()=>{u&&u.cancel()})}),{cancel:()=>{u&&u.cancel(),o.task(function*(){s(e,"down",n),s(e,"up",i)})}}}}};let u={down:{},up:{}};function c(e,t,n){let o;e=e.toLowerCase(),u[t][e]||(u[t][e]=[]);let r=()=>{o&&!o.completed()||(o=i.sequence(n))};return u[t][e].push(r),r}function s(e,t,n){if(e=e.toLowerCase(),!u[t][e])return;let o=u[t][e].indexOf(n);u[t][e].splice(o,1)}document.addEventListener("keydown",e=>{let t=e.key.toLowerCase();u.down[t]&&0!==u.down[t].length&&u.down[t].slice(-1)[0]()}),document.addEventListener("keyup",e=>{let t=e.key.toLowerCase();u.up[t]&&0!==u.up[t].length&&u.up[t].slice(-1)[0]()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(15),i=n(6),r=n(16),u=n(17),c=n(0);function s(e,t){return"aabb"===e.type()&&"aabb"===t.type()?function(e,t){let n=[i.vector(0,1),i.vector(1,0)];return o.sat(e,t,n)}(e,t):"sphere"===e.type()&&"sphere"===t.type()?function(e,t){let n=[i.vector.normalize(i.vector.sub(e.center(),t.center()))];return o.sat(e,t,n)}(e,t):void 0}function a(e,t){if(e&&t)for(let n=0;n<e.length;n++)for(let o=e===t?n+1:0;o<t.length;o++){if(e[n]===t[o])continue;let r=s(e[n],t[o]);r&&(e[n].collision(r,t[o].object()),t[o].collision(i.vector.neg(r),e[n].object()))}}t.collision=function(){let e={"":[]};return{aabb:t=>{let n,o=r.aabb(t),i="",u={type:()=>"aabb",collision:(e,t)=>{n&&n(e,t)},object:()=>t,center:()=>o.center(),points:()=>o.points(),radius:()=>0};return e[i].push(u),{group:function(t){return c.task(function*(){e[i].splice(e[i].indexOf(u),1),e[i=t]||(e[i]=[]),e[i].push(u)}),this},show:function(){return o.show(),this},size:function(e,t){return o.size(e,t),this},handle:function(e){return n=e,this}}},sphere:t=>{let n,o=u.sphere(t),i="",r={type:()=>"sphere",collision:(e,t)=>{n&&n(e,t)},object:()=>t,center:()=>o.center(),points:()=>o.points(),radius:()=>o.radius()||0};return e[i].push(r),{group:function(t){return c.task(function*(){e[i].splice(e[i].indexOf(r),1),e[i=t]||(e[i]=[]),e[i].push(r)}),this},show:function(){return o.show(),this},size:function(e){return o.size(e),this},handle:function(e){return n=e,this}}},detect:(t=[{a:"",b:""}])=>{c.task(function*(){for(let n of t)a(e[n.a],e[n.b])})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6);function i(e,t){let n=e.points(),i=e.radius(),u=o.vector.dot(n[0],t),c=u,s=u;for(let e=1;e<n.length;e++)u=o.vector.dot(n[e],t),c=Math.min(u,c),s=Math.max(u,s);return new r(c-i,s+i)}class r{constructor(e,t){this.min=e,this.max=t}overlap(e){return this.min<e.min?e.min-this.max:this.min-e.max}}t.sat=function(e,t,n){let r=Number.MAX_VALUE,u=o.vector();for(let o of n){let n=i(e,o),c=i(t,o);if(n.overlap(c)>=0)return;Math.abs(n.overlap(c))<r&&(r=Math.abs(n.overlap(c)),u=o)}let c=o.vector.sub(e.center(),t.center());return o.vector.dot(c,u)<0&&(u=o.vector.neg(u)),o.vector.mul(u,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),i=n(0);t.aabb=function(e){let t,n,r,u=!1;function c(){let o;r&&e.removeChild(r),o=t&&n?new PIXI.Rectangle(t/-2,n/-2,t,n):e.getLocalBounds(),(r=new PIXI.Graphics(!0)).visible=u,r.lineStyle(u?1e-4:0,16711680,.8),r.moveTo(o.left,o.top).lineTo(o.right,o.top).lineTo(o.right,o.bottom).lineTo(o.left,o.bottom).lineTo(o.left,o.top),e.addChild(r)}return c(),{points:()=>{let e=r.getBounds();return[o.vector(e.left,e.top),o.vector(e.right,e.bottom),o.vector(e.right,e.top),o.vector(e.left,e.bottom)]},size:function(e,o){t=e,n=o,i.task(function*(){c()})},show:function(){u=!0,i.task(function*(){c()})},center:function(){let{x:t,y:n}=e.getGlobalPosition();return o.vector(t,n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),i=n(0);t.sphere=function(e){let t,n,r=!1;function u(){n&&e.removeChild(n);let o=t;o||(o=e.getLocalBounds().width/2),(n=new PIXI.Graphics(!0)).visible=r,n.lineStyle(r?1e-4:0,16711680,.8),n.drawCircle(0,0,o),e.addChild(n)}return u(),{points:function(){return[this.center()]},size:function(e){t=e,i.task(function*(){u()})},radius:function(){return n.getBounds().width/2},show:function(){r=!0,i.task(function*(){u()})},center:function(){let{x:t,y:n}=e.getGlobalPosition();return o.vector(t,n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(5);t.wait=function(e=Number.MAX_VALUE){let t=!1;return o.task(function*(){let n=0;for(;n<e&&!t;)n+=i.time.elapsed(),yield}),{cancel:()=>{o.task(function*(){t=!0})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),i=n(0);t.parallel=function(e){let t=!1,n=!1,r=function*(){let o=i.task.get_tasks(e).reverse().map(e=>e());for(;o.length>0;){for(let e=o.length-1;e>=0;e--){if(n)return void(t=!0);o[e].next().done&&o.splice(e,1)}yield}t=!0};return i.task.have_task_manager()?i.task(function*(){yield*r()}):o.thread(function*(){yield*r()}),{cancel:()=>{i.task(function*(){n=!0})},completed:()=>t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1),r=n(4);t.move=function(e){let t={},n={},u=r.ease.linear,c=0;return i.sequence(()=>{void 0===t.x&&void 0===t.y?(void 0!==n.x&&(n.x+=e.x),void 0!==n.y&&(n.y+=e.y),o.tween(e).to(n).time(c).ease(u)):o.tween(e).to(t).time(c).ease(u)}),{to:function(e){return void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this},by:function(e){return void 0!==e.x&&(n.x=e.x),void 0!==e.y&&(n.y=e.y),this},ease:function(e=r.ease.sine_inout){return u=e,this},time:function(e){return c=e,this}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1),r=n(4),u=2*Math.PI/360;t.rotate=function(e){let t,n,c=r.ease.linear,s=0;return i.sequence(()=>{let i=e.rotation;void 0!==n&&(i=e.rotation+n*u),void 0!==t&&(i=t*u),o.tween(e).to({rotation:i}).time(s).ease(c)}),{to:function(e){return t=e,this},by:function(e){return n=e,this},ease:function(e=r.ease.sine_inout){return c=e,this},time:function(e){return s=e,this}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1),r=n(4);t.scale=function(e){let t={},n={},u=r.ease.linear,c=0;return i.sequence(()=>{void 0===t.x&&void 0===t.y?(void 0!==n.x&&(n.x+=e.scale.x),void 0!==n.y&&(n.y+=e.scale.y),o.tween(e.scale).to(n).time(c).ease(u)):o.tween(e.scale).to(t).time(c).ease(u)}),{to:function(e){return"number"==typeof e?(t.x=e,t.y=e):(void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y)),this},by:function(e){return"number"==typeof e?(n.x=e,n.y=e):(void 0!==e.x&&(n.x=e.x),void 0!==e.y&&(n.y=e.y)),this},ease:function(e=r.ease.sine_inout){return u=e,this},time:function(e){return c=e,this}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1);t.show=function(e){let t=0;return i.sequence(()=>{o.tween(e).to({alpha:1}).time(t)}),{time:function(e){t=e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),i=n(1);t.hide=function(e){let t=0;return i.sequence(()=>{o.tween(e).to({alpha:0}).time(t)}),{time:function(e){t=e}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.sound=function(e){let t=!1;return o.task(function*(){let n=new Audio(e);n.onended=(()=>{t=!0}),n.play()}),{wait:function(){o.task(function*(){for(;!t;)yield})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(3);t.proceed=function(e){let t,n=!1,r=0;return o.task(function*(){n||(t=i.thread(function*(){let t=o.task.get_tasks(e);for(let e of t)yield*e()})).priority(r)}),{cancel:function(){t&&t.cancel(),n=!0},priority:function(e){return t&&t.priority(e),r=e,this}}}}])});